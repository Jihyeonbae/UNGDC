<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dynamic UNGDC</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="UNGDC_topic_modeling_files/libs/clipboard/clipboard.min.js"></script>
<script src="UNGDC_topic_modeling_files/libs/quarto-html/quarto.js"></script>
<script src="UNGDC_topic_modeling_files/libs/quarto-html/popper.min.js"></script>
<script src="UNGDC_topic_modeling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="UNGDC_topic_modeling_files/libs/quarto-html/anchor.min.js"></script>
<link href="UNGDC_topic_modeling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="UNGDC_topic_modeling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="UNGDC_topic_modeling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="UNGDC_topic_modeling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="UNGDC_topic_modeling_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dynamic UNGDC</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="dynamic-topic-modeling-for-ungdc" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-topic-modeling-for-ungdc">Dynamic Topic Modeling for UNGDC</h2>
<p>In order to generate LDA topic modeling results for the corpus of UNGD, I split the corpus into different time frames. The entire time span of 1945 until 2022 is split into 8 intervals, with a duration of 10 years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gplots)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seededlda)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slam)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>light <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/Desktop/UNGDC/data/processed/cleaned.RDS"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up the parameters</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>light_interval <span class="ot">&lt;-</span> light <span class="sc">%&gt;%</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">span =</span> <span class="fu">as.factor</span>(<span class="fu">cut</span>(year,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1945</span>, <span class="at">to =</span> <span class="dv">2022</span>, <span class="at">by =</span> <span class="dv">10</span>), <span class="dv">2022</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="term-frequency-inverse-matrix-and-descriptive-data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="term-frequency-inverse-matrix-and-descriptive-data-visualization">Term Frequency-Inverse Matrix and Descriptive Data Visualization</h2>
<ul>
<li>To inspect the data and frequent words across time intervals, below code generates top-20 terms based on the tf-idf scores.</li>
<li>Input dataset: <a href="https://github.com/Jihyeonbae/UNGDC">“data/processed/cleaned.RDS”</a>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I added two additional stop words that aren't captured in the generic stop words dictionary. </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>mystopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"will"</span>, <span class="st">"must"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for generating tf_idf and plots.</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">levels</span>(light_interval<span class="sc">$</span>span), <span class="cf">function</span>(i) {</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  subset_i <span class="ot">&lt;-</span> light_interval <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(span <span class="sc">%in%</span> i)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  corpus_subset <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(subset_i<span class="sc">$</span>text))</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  tdm <span class="ot">&lt;-</span> <span class="fu">TermDocumentMatrix</span>(corpus_subset,</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                            <span class="at">control =</span> <span class="fu">list</span>(<span class="at">weighting =</span> weightTfIdf,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">removePunctuation =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">stemming =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">removeNumbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">stopwords =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">removewords =</span> mystopwords))</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  top_terms <span class="ot">&lt;-</span> slam<span class="sc">::</span><span class="fu">row_sums</span>(<span class="fu">as.matrix</span>(tdm))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame with terms and tfidf values</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  top_terms_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">term =</span> <span class="fu">names</span>(top_terms), <span class="at">tfidf =</span> top_terms)</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order the terms by tfidf value</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  top_terms_df <span class="ot">&lt;-</span> top_terms_df[<span class="fu">order</span>(top_terms_df<span class="sc">$</span>tfidf, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the top 20 terms</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  top_terms_df <span class="ot">&lt;-</span> <span class="fu">head</span>(top_terms_df, <span class="dv">20</span>)</span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  figure_i <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(top_terms_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(term, tfidf), <span class="at">y =</span> tfidf)) <span class="sc">+</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 Terms by TF-IDF"</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Terms"</span>,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"TF-IDF Score"</span>) <span class="sc">+</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"figs/"</span>, <span class="fu">paste0</span>(<span class="st">"plot_"</span>, i, <span class="st">".png"</span>))</span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(output_file, figure_i, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print out one sample</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"figs/plot_(2015, 2022].png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "figs/plot_(2015, 2022].png"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"figs/plot_(2005, 2015].png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "figs/plot_(2005, 2015].png"</code></pre>
</div>
</div>
<ul>
<li>dfm function helps remove stop words and perform other preprocessing steps to create a more refined document-feature matrix. Additionally, the subsequent dfm_tfidf function is used to compute TF-IDF (Term Frequency-Inverse Document Frequency) scores, which down-weights terms that appear frequently across documents.</li>
</ul>
</section>
<section id="lda-topic-modeling" class="level1">
<h1>LDA Topic Modeling</h1>
<ul>
<li><p>In this section, I perform topic modeling using LDA, an unsupervised method to estimate vectors that represent topics within a speech.It assumes that each speech doument is a mixture of topics, and each word is attributable to one of the document’s topics.</p></li>
<li><p>Current parameters in the below code sets the number of topics as 10, and uses the TF-IDF scores.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Topic Modeling</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>lda_generator <span class="ot">&lt;-</span> <span class="cf">function</span>(corpus, span_levels, <span class="at">num_topics =</span> <span class="dv">10</span>) {</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  output_dir <span class="ot">&lt;-</span> <span class="st">"output/lda/decade_0203"</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(output_dir)) {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(output_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> span_levels) {</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>    subset <span class="ot">&lt;-</span> corpus[corpus<span class="sc">$</span>span <span class="sc">==</span> i, ]</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    subset_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(subset<span class="sc">$</span>text,</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                      <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                      <span class="at">split_hyphens =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stem =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tolower =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">remove =</span> <span class="fu">stopwords</span>(<span class="st">"english"</span>))</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>    dfm_idf <span class="ot">&lt;-</span> <span class="fu">dfm_tfidf</span>(subset_dfm,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                         <span class="at">scheme_tf =</span> <span class="st">"count"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>                         <span class="at">scheme_df =</span> <span class="st">"inverse"</span>)</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>    timing <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>      dfm_df <span class="ot">&lt;-</span> <span class="fu">convert</span>(dfm_idf, <span class="at">to =</span> <span class="st">"data.frame"</span>)</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>      dfm_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="fu">paste0</span>(<span class="st">"dfm_"</span>, i, <span class="st">".RDS"</span>))</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(dfm_df, dfm_output_file)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      tmod_lda <span class="ot">&lt;-</span> <span class="fu">textmodel_lda</span>(subset_dfm, <span class="at">k =</span> num_topics)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>      lda_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="fu">paste0</span>(<span class="st">"lda_model_"</span>, i, <span class="st">".RDS"</span>))</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(tmod_lda, lda_output_file)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Time taken for %s: %s seconds</span><span class="sc">\n</span><span class="st">"</span>, i, timing[<span class="dv">3</span>]))</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each decade and save separate LDA results. </span></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>span_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(light_interval<span class="sc">$</span>span)</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a><span class="co">#lda_generator(light_interval, span_levels)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="reading-in-lda-results" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-lda-results">Reading in LDA results</h2>
<p>After running the LDA model, I read in each LDA results as a separate element in a list form. Below code prins out top 10 terms associated with each topic in the LDA models for different span levels. Each row represents one semantic topic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>read_lda_models <span class="ot">&lt;-</span> <span class="cf">function</span>(span_levels, <span class="at">output_dir =</span> <span class="st">"output/lda/decade_0120"</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  lda_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> span_levels) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    lda_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="fu">paste0</span>(<span class="st">"lda_model_"</span>, i, <span class="st">".RDS"</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">file.exists</span>(lda_output_file)) {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>      lda_model <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(lda_output_file)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      lda_models[[i]] <span class="ot">&lt;-</span> lda_model</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"LDA model for %s successfully loaded.</span><span class="sc">\n</span><span class="st">"</span>, i))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"LDA model file for %s not found.</span><span class="sc">\n</span><span class="st">"</span>, i))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lda_models)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>output_directory <span class="ot">&lt;-</span> <span class="st">"~/Desktop/UNGDC/output/lda/decade_0120"</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>lda_models <span class="ot">&lt;-</span> <span class="fu">read_lda_models</span>(span_levels, output_directory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LDA model for (1945,1955] successfully loaded.
LDA model for (1955,1965] successfully loaded.
LDA model for (1965,1975] successfully loaded.
LDA model for (1975,1985] successfully loaded.
LDA model for (1985,1995] successfully loaded.
LDA model for (1995,2005] successfully loaded.
LDA model for (2005,2015] successfully loaded.
LDA model for (2015,2022] successfully loaded.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>topic_tables <span class="ot">&lt;-</span> <span class="cf">function</span>(lda_models, span_levels) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  topic_tables <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> span_levels) {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%in%</span> <span class="fu">names</span>(lda_models)) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      lda_model <span class="ot">&lt;-</span> lda_models[[i]]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      terms <span class="ot">&lt;-</span> <span class="fu">terms</span>(lda_model, <span class="dv">10</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      topic_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Terms =</span> terms)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      topic_tables[[i]] <span class="ot">&lt;-</span> topic_table</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"LDA model for %s not found.</span><span class="sc">\n</span><span class="st">"</span>, i))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  all_topics <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, topic_tables)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(all_topics)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>topic_tables <span class="ot">&lt;-</span> <span class="fu">topic_tables</span>(lda_models, span_levels)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(topic_tables)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Terms.topic1 Terms.topic2 Terms.topic3 Terms.topic4 Terms.topic5
(1945,1955].1        econom        korea        state         arab         will
(1945,1955].2       countri    communist         unit       israel           us
(1945,1955].3       develop      aggress          war     palestin          can
(1945,1955].4        social       soviet       soviet        right          one
(1945,1955].5       product       chines         peac       refuge        world
(1945,1955].6       technic        peopl        union         east          may
(1945,1955].7      industri        china         atom        franc         must
(1945,1955].8      programm       korean       propos        egypt          say
(1945,1955].9      american         peac        peopl        peopl          now
(1945,1955].10        trade         year       polici        state         time
(1955,1965].1        nation         arab       nation         viet         unit
(1955,1965].2          unit       israel        world        india          one
(1955,1965].3        intern     palestin        peopl          nam      assembl
(1955,1965].4          peac        franc         will          lao       nation
(1955,1965].5          will         unit           us        china       govern
(1955,1965].6       countri     algerian         peac    communist         will
(1955,1965].7       general         east         must        south        state
(1955,1965].8         world        middl          one     pakistan      countri
(1955,1965].9       develop      algeria          can         asia          say
(1955,1965].10      problem       french      countri       chines         time
(1965,1975].1        intern        state       nation       africa        state
(1965,1975].2        nation         unit         will      african       intern
(1965,1975].3       countri        peopl         year        south       nation
(1965,1975].4          will         peac         unit        peopl       govern
(1965,1975].5       develop       republ          new       govern        latin
(1965,1975].6         world       intern         issu         unit     american
(1965,1975].7          peac       soviet          can       coloni     principl
(1965,1975].8        econom       nation        world      countri          law
(1965,1975].9          unit        secur          now       nation          sea
(1965,1975].10        peopl      countri        power     independ      america
(1975,1985].1        govern        peopl       govern        state       intern
(1975,1985].2          unit      countri      america      nuclear      countri
(1975,1985].3          will      struggl     american       weapon         peac
(1975,1985].4        nation     independ        state         peac       nation
(1975,1985].5          must         unit      countri       soviet         unit
(1975,1985].6       nuclear      aggress        latin         unit      develop
(1975,1985].7         human  imperialist      central        peopl        secur
(1975,1985].8         right      support        polit       republ       region
(1975,1985].9         south    kampuchea       panama          arm        state
(1975,1985].10       negoti       nation        peopl        union       effort
(1985,1995].1       develop        world       nation      countri         unit
(1985,1995].2        nation         will        peopl       africa       nation
(1985,1995].3       countri       nation      countri      african        state
(1985,1995].4          unit        peopl         peac        peopl         must
(1985,1995].5         south           us         unit       govern         peac
(1985,1995].6         state          can        south         peac      nuclear
(1985,1995].7       continu          one      nuclear        south       weapon
(1985,1995].8        govern         must       govern        organ        secur
(1985,1995].9        global          new        state       nation        organ
(1985,1995].10       econom          war  afghanistan        state         oper
(1995,2005].1        nation       nation       nation        state       intern
(1995,2005].2        intern        world         unit         unit      countri
(1995,2005].3        region         must       intern       nation      develop
(1995,2005].4       countri           us        secur      council        world
(1995,2005].5          unit         unit      develop       intern         will
(1995,2005].6        cooper         will      general        secur         peac
(1995,2005].7          peac          can        human      countri       econom
(1995,2005].8        republ          new        right        power       nation
(1995,2005].9          will        human       reform        right        organ
(1995,2005].10        state          one      council        peopl       social
(2005,2015].1        intern      countri       nation       region       nation
(2005,2015].2          peac        peopl      african     european         unit
(2005,2015].3         state        state       africa       intern       intern
(2005,2015].4         peopl         unit         peac      countri      develop
(2005,2015].5         secur       govern         unit  afghanistan        secur
(2005,2015].6   palestinian        human        secur        union        human
(2005,2015].7       countri       presid      countri        state        right
(2005,2015].8        region        world      general        europ         peac
(2005,2015].9          arab       nation      assembl        secur         will
(2005,2015].10         will        right       govern       cooper        state
(2015,2022].1        intern      african       pandem         will      countri
(2015,2022].2      european      countri        covid        world        state
(2015,2022].3         secur       nation       presid           us        peopl
(2015,2022].4        ukrain         peac           mr         must       govern
(2015,2022].5         state       africa       global       nation         unit
(2015,2022].6       countri        secur       vaccin        peopl       intern
(2015,2022].7           war         unit       health          can        right
(2015,2022].8         union       govern           un          one        human
(2015,2022].9         right       republ         need         unit       social
(2015,2022].10    territori        state        world         year         peac
               Terms.topic6 Terms.topic7 Terms.topic8 Terms.topic9
(1945,1955].1        nation        human      council       confer
(1945,1955].2          unit        peopl      assembl       govern
(1945,1955].3          peac      freedom      charter      problem
(1945,1955].4        intern         peac        secur        peopl
(1945,1955].5         world        right       member        india
(1945,1955].6          will        world        state         asia
(1945,1955].7         state        power      general       geneva
(1945,1955].8         organ       justic         veto        south
(1945,1955].9       problem          war        power         atom
(1945,1955].10      general          men         unit     question
(1955,1965].1       countri        state      nuclear       africa
(1955,1965].2       develop         unit      disarma      african
(1955,1965].3        econom        peopl         test        south
(1955,1965].4      industri         peac       weapon       govern
(1955,1965].5       product      countri    agreement       coloni
(1955,1965].6        social       republ        power        peopl
(1955,1965].7          year       soviet       soviet        state
(1955,1965].8       economi       govern       negoti     independ
(1955,1965].9       resourc          war      control       republ
(1955,1965].10        price      general         unit    territori
(1965,1975].1       countri       israel        peopl        world
(1965,1975].2       develop         arab         unit           us
(1965,1975].3        econom         unit         viet         will
(1965,1975].4       product        peopl        state          one
(1965,1975].5      industri        state      countri          can
(1965,1975].6           per    territori          nam       nation
(1965,1975].7         trade      resolut      struggl      countri
(1965,1975].8         price         peac      aggress         must
(1965,1975].9         world        secur  imperialist        great
(1965,1975].10         cent       nation       republ        power
(1975,1985].1        africa         arab       intern        world
(1975,1985].2         peopl       israel       nation       nation
(1975,1985].3       african        state      countri         will
(1975,1985].4         south  palestinian      develop           us
(1975,1985].5        govern         unit         peac          one
(1975,1985].6         regim        peopl         will          can
(1975,1985].7        republ         peac         unit         must
(1975,1985].8         state      resolut       econom      countri
(1975,1985].9       namibia      aggress        right        peopl
(1975,1985].10      struggl        secur      general        human
(1985,1995].1         state       intern      countri        state
(1985,1995].2         europ      develop       govern       intern
(1985,1995].3      european      countri        state        secur
(1985,1995].4          unit         peac       intern        peopl
(1985,1995].5        nation        world      america         unit
(1985,1995].6        republ       nation     american      resolut
(1985,1995].7         secur         will        peopl         arab
(1985,1995].8         polit       econom      central         peac
(1985,1995].9        intern      problem       social      countri
(1985,1995].10      countri           co        latin      council
(1995,2005].1       develop         peac      countri         unit
(1995,2005].2       countri       intern         peac       nation
(1995,2005].3        nation        secur       africa        secur
(1995,2005].4         state       region      african       intern
(1995,2005].5        island        peopl      develop       terror
(1995,2005].6        econom  palestinian       intern         must
(1995,2005].7         small        state       govern      develop
(1995,2005].8        global         will    communiti         will
(1995,2005].9          unit         arab       nation      council
(1995,2005].10       intern       israel     conflict      general
(2005,2015].1       develop      develop      countri        world
(2005,2015].2        island      countri       intern         will
(2005,2015].3        nation       global         peac         must
(2005,2015].4         state        world      african       nation
(2005,2015].5         small       econom        secur        peopl
(2005,2015].6          unit        chang        state           us
(2005,2015].7        climat       intern      general          can
(2005,2015].8         chang       climat    communiti         unit
(2005,2015].9         pacif         will       nation         year
(2005,2015].10      continu        crisi       republ          one
(2015,2022].1       develop         unit       intern       nation
(2015,2022].2       countri       nation        state      develop
(2015,2022].3           per         peac        peopl       intern
(2015,2022].4          cent        state      countri         unit
(2015,2022].5        climat       intern        secur      sustain
(2015,2022].6          year      countri         peac         peac
(2015,2022].7          educ         will       terror        secur
(2015,2022].8        govern      develop       region         will
(2015,2022].9        energi        korea  palestinian         also
(2015,2022].10      economi      nuclear       nation        human
               Terms.topic10
(1945,1955].1        countri
(1945,1955].2         govern
(1945,1955].3          greec
(1945,1955].4            war
(1945,1955].5          peopl
(1945,1955].6     yugoslavia
(1945,1955].7          greek
(1945,1955].8             mr
(1945,1955].9        germani
(1945,1955].10      question
(1955,1965].1       american
(1955,1965].2          state
(1955,1965].3        america
(1955,1965].4          latin
(1955,1965].5         govern
(1955,1965].6          peopl
(1955,1965].7          right
(1955,1965].8         system
(1955,1965].9        respect
(1955,1965].10        intern
(1965,1975].1         nation
(1965,1975].2           unit
(1965,1975].3        develop
(1965,1975].4           peac
(1965,1975].5         intern
(1965,1975].6           will
(1965,1975].7        general
(1965,1975].8        countri
(1965,1975].9        problem
(1965,1975].10         world
(1975,1985].1        develop
(1975,1985].2        countri
(1975,1985].3         econom
(1975,1985].4          world
(1975,1985].5         nation
(1975,1985].6         intern
(1975,1985].7          south
(1975,1985].8        continu
(1975,1985].9        resourc
(1975,1985].10          issu
(1985,1995].1         intern
(1985,1995].2        develop
(1985,1995].3         nation
(1985,1995].4           peac
(1985,1995].5          world
(1985,1995].6           unit
(1985,1995].7           will
(1985,1995].8        countri
(1985,1995].9         econom
(1985,1995].10           new
(1995,2005].1          peopl
(1995,2005].2        countri
(1995,2005].3         terror
(1995,2005].4       children
(1995,2005].5          world
(1995,2005].6    afghanistan
(1995,2005].7           year
(1995,2005].8           will
(1995,2005].9      terrorist
(1995,2005].10        govern
(2005,2015].1        develop
(2005,2015].2         govern
(2005,2015].3          peopl
(2005,2015].4           year
(2005,2015].5           will
(2005,2015].6         nation
(2005,2015].7         agenda
(2005,2015].8           goal
(2005,2015].9        sustain
(2005,2015].10       countri
(2015,2022].1         nation
(2015,2022].2         island
(2015,2022].3         climat
(2015,2022].4        develop
(2015,2022].5          state
(2015,2022].6          chang
(2015,2022].7           unit
(2015,2022].8          small
(2015,2022].9          ocean
(2015,2022].10         peopl</code></pre>
</div>
</div>
<ul>
<li><p>Each column in the dataset corresponds to a vector of terms representing a specific topic. However, extracting substantively meaningful topics poses challenges due to several issues. One notable challenge is the variability in the set of terms used to represent the same topic across different time periods. For instance, the topic of international security may be discussed in relation to the Soviet Union and North Korea in earlier time periods, whereas in more recent times, it may be associated with Russia and Ukraine.</p></li>
<li><p>Another important problem is identifying related topics over time. There is a difficulty of establishing connections between topics and understanding their evolution across different temporal contexts. Some topics and terms disappear abruptly, while new topics emerge. Identifying the connection between vectors poses a challenge.</p></li>
</ul>
</section>
<section id="dynamic-topic-modeling" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-topic-modeling">Dynamic Topic Modeling</h2>
<ul>
<li>To address the above mentioned challenges, we refered to existing papers.</li>
<li><code>"BERTopic Dynamic Topic Modeling"</code>(https://maartengr.github.io/BERTopic/getting_started/topicsovertime/topicsovertime.html)</li>
<li>Greene and cross, 2017 (https://doi.org/10.1017/pan.2016.7)</li>
</ul>
<section id="this-generates-output-for-a-single-pair-of-time-frames" class="level3">
<h3 class="anchored" data-anchor-id="this-generates-output-for-a-single-pair-of-time-frames">This generates output for a single pair of time frames</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model1<span class="ot">&lt;-</span>lda_models[[<span class="dv">1</span>]]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">&lt;-</span>lda_models[[<span class="dv">2</span>]]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># phi value is a topic probability of every word</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>phi1 <span class="ot">&lt;-</span> model1<span class="sc">$</span>phi</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#phi1$topic &lt;- sequence(nrow(phi1))</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>phi2 <span class="ot">&lt;-</span> model2<span class="sc">$</span>phi</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#phi2$topic &lt;- sequence(nrow(phi2))</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert matrices to data frames</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>phi1_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phi1)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>phi2_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phi2)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>order_phi1 <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi1_df), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>order_phi2 <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi2_df), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns based on the mean</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>phi1_df <span class="ot">&lt;-</span> phi1_df[, order_phi1]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>phi2_df <span class="ot">&lt;-</span> phi2_df[, order_phi2]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify columns to drop based on colMeans</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Try without dropping</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>columns_to_drop_phi1 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(phi1_df) <span class="sc">&lt;</span> <span class="fl">0.00001</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>columns_to_drop_phi2 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(phi2_df) <span class="sc">&lt;</span> <span class="fl">0.00001</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop identified columns</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>phi1_df <span class="ot">&lt;-</span> phi1_df[, <span class="sc">!</span>columns_to_drop_phi1, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>phi2_df <span class="ot">&lt;-</span> phi2_df[, <span class="sc">!</span>columns_to_drop_phi2, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the union of column names</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>all_terms <span class="ot">&lt;-</span> <span class="fu">union</span>(<span class="fu">colnames</span>(phi1_df), <span class="fu">colnames</span>(phi2_df))</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co">#fill missing values with zeros</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>phi1_union <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(phi1_df, <span class="fu">setNames</span>(<span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(phi1_df), <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi1_df))))), <span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi1_df))))</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>phi2_union <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(phi2_df, <span class="fu">setNames</span>(<span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(phi2_df), <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi2_df))))), <span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi2_df))))</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns alphabetically</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>phi1_union <span class="ot">&lt;-</span> phi1_union[, <span class="fu">order</span>(<span class="fu">colnames</span>(phi1_union))]</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>phi2_union <span class="ot">&lt;-</span> phi2_union[, <span class="fu">order</span>(<span class="fu">colnames</span>(phi2_union))]</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(phi1_union)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(phi2_union)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>cor<span class="ot">&lt;-</span><span class="fu">cor</span>(<span class="fu">t</span>(phi1_union), <span class="fu">t</span>(phi2_union))</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap.2</span>(cor,</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>          <span class="at">Rowv =</span> <span class="cn">FALSE</span>, <span class="at">Colv =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">256</span>),</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">trace =</span> <span class="st">"none"</span>, <span class="co"># no row/column names</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">key =</span> <span class="cn">TRUE</span>, <span class="at">keysize =</span> <span class="fl">1.5</span>,</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">density.info =</span> <span class="st">"none"</span>, <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">cexCol =</span> <span class="dv">1</span>, <span class="at">cexRow =</span> <span class="dv">1</span>, <span class="co"># adjust text size</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>          <span class="at">notecol =</span> <span class="st">"black"</span>, <span class="at">notecex =</span> <span class="fl">0.7</span>,</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">main =</span> <span class="st">"Correlation Matrix"</span>,</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">"Period 2"</span>, <span class="at">ylab =</span> <span class="st">"Period 1"</span>,</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">symkey =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>order_phi1_union <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi1_union), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>phi1_result <span class="ot">&lt;-</span> phi1_union[, order_phi1_union]</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>order_phi2_union <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi2_union), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>phi2_result <span class="ot">&lt;-</span> phi2_union[, order_phi2_union]</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>phi1_result_row <span class="ot">&lt;-</span> <span class="fu">orderBasedOnRow</span>(phi1_union, <span class="dv">1</span>)</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>phi1_result_long<span class="ot">&lt;-</span>phi1_result_row<span class="sc">%&gt;%</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to=</span><span class="st">"term_1"</span>, <span class="at">values_to=</span><span class="st">"probability_1"</span>)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>phi2_result_row <span class="ot">&lt;-</span> <span class="fu">orderBasedOnRow</span>(phi2_union, <span class="dv">6</span>)</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>phi2_result_long<span class="ot">&lt;-</span>phi2_result_row<span class="sc">%&gt;%</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to=</span><span class="st">"term_2"</span>, <span class="at">values_to=</span><span class="st">"probability_2"</span>)</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>pair<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(phi1_result_long, phi2_result_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>#Function to print out the words</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>orderBasedOnRow <span class="ot">&lt;-</span> <span class="cf">function</span>(df, I) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order columns based on the Ith row values</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  ordered_cols <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">apply</span>(df, <span class="dv">2</span>, <span class="cf">function</span>(x) x[I]), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reorder the data frame columns</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  ordered_df <span class="ot">&lt;-</span> df[, ordered_cols]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  ordered_row <span class="ot">&lt;-</span> ordered_df[I, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ordered_row)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="below-function-generates-heatmaps-for-a-pair-of-models." class="level2">
<h2 class="anchored" data-anchor-id="below-function-generates-heatmaps-for-a-pair-of-models.">Below function generates heatmaps for a pair of models.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate the heatmap for a pair of models</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>generate_heatmap <span class="ot">&lt;-</span> <span class="cf">function</span>(model1, model2, <span class="at">correlation_threshold =</span> <span class="fl">0.9</span>) {</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  phi1 <span class="ot">&lt;-</span> model1<span class="sc">$</span>phi</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  phi2 <span class="ot">&lt;-</span> model2<span class="sc">$</span>phi</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  phi1_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phi1)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  phi2_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phi2)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  order_phi1 <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi1_df), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  order_phi2 <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi2_df), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  phi1_df <span class="ot">&lt;-</span> phi1_df[, order_phi1]</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  phi2_df <span class="ot">&lt;-</span> phi2_df[, order_phi2]</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  all_terms <span class="ot">&lt;-</span> <span class="fu">union</span>(<span class="fu">colnames</span>(phi1_df), <span class="fu">colnames</span>(phi2_df))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  phi1_union <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(phi1_df, <span class="fu">setNames</span>(<span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(phi1_df), <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi1_df))))), <span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi1_df))))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  phi2_union <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(phi2_df, <span class="fu">setNames</span>(<span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(phi2_df), <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi2_df))))), <span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi2_df))))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  phi1_union <span class="ot">&lt;-</span> phi1_union[, <span class="fu">order</span>(<span class="fu">colnames</span>(phi1_union))]</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  phi2_union <span class="ot">&lt;-</span> phi2_union[, <span class="fu">order</span>(<span class="fu">colnames</span>(phi2_union))]</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(phi1_union)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(phi2_union)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">t</span>(phi1_union), <span class="fu">t</span>(phi2_union))</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Heatmap for correlation matrix</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">heatmap.2</span>(cor_matrix,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">Rowv =</span> <span class="cn">FALSE</span>, <span class="at">Colv =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">16</span>),</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">trace =</span> <span class="st">"none"</span>, <span class="co"># no row/column names</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">key =</span> <span class="cn">TRUE</span>, <span class="at">keysize =</span> <span class="fl">1.5</span>,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">density.info =</span> <span class="st">"none"</span>, <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">cexCol =</span> <span class="dv">1</span>, <span class="at">cexRow =</span> <span class="dv">1</span>, <span class="co"># adjust text size</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">notecol =</span> <span class="st">"black"</span>, <span class="at">notecex =</span> <span class="fl">0.7</span>,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlab =</span> <span class="st">"Time 2"</span>,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">ylab =</span> <span class="st">"Time 1"</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">symkey =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">phi1_union =</span> phi1_union, <span class="at">phi2_union =</span> phi2_union, <span class="at">cor_matrix =</span> cor_matrix))</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rows-with-high-correlation" class="level2">
<h2 class="anchored" data-anchor-id="rows-with-high-correlation">Rows with high correlation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to print the ordered rows for each topic with high correlation</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>print_ordered_rows <span class="ot">&lt;-</span> <span class="cf">function</span>(phi1_union, phi2_union, cor_matrix, high_corr_indices, <span class="at">correlation_threshold =</span> <span class="fl">0.9</span>) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find indices where correlation is higher than the threshold</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  high_corr_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(cor_matrix <span class="sc">&gt;</span> correlation_threshold <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(cor_matrix), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty list to store results</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  result_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the ordered rows for each topic with high correlation</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(high_corr_indices))) {</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    model1_topic <span class="ot">&lt;-</span> high_corr_indices[i, <span class="dv">1</span>]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    model2_topic <span class="ot">&lt;-</span> high_corr_indices[i, <span class="dv">2</span>]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the ordered rows for each model's topic</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Model 1 - Topic"</span>, model1_topic), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    phi1_result_row <span class="ot">&lt;-</span> <span class="fu">orderBasedOnRow</span>(phi1_union, model1_topic)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Model 2 - Topic"</span>, model2_topic), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    phi2_result_row <span class="ot">&lt;-</span> <span class="fu">orderBasedOnRow</span>(phi2_union, model2_topic)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert result rows to long format</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    phi1_result_long <span class="ot">&lt;-</span> phi1_result_row <span class="sc">%&gt;%</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"term_1"</span>, <span class="at">values_to =</span> <span class="st">"probability_1"</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    phi2_result_long <span class="ot">&lt;-</span> phi2_result_row <span class="sc">%&gt;%</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"term_2"</span>, <span class="at">values_to =</span> <span class="st">"probability_2"</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine phi1 and phi2 results</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    pair <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(phi1_result_long, phi2_result_long)</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append the result to the list</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    result_list[[i]] <span class="ot">&lt;-</span> pair</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all results into a single dataframe</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  final_result <span class="ot">&lt;-</span> <span class="fu">do.call</span>(bind_rows, result_list)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(final_result)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="execute-functions-over-pairs" class="level2">
<h2 class="anchored" data-anchor-id="execute-functions-over-pairs">Execute functions over pairs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through pairs of models to generate heatmaps and print results</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(lda_models) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  model1 <span class="ot">&lt;-</span> lda_models[[i]]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  model2 <span class="ot">&lt;-</span> lda_models[[i <span class="sc">+</span> <span class="dv">1</span>]]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">generate_heatmap</span>(model1, model2, <span class="at">correlation_threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  phi1_union <span class="ot">&lt;-</span> result<span class="sc">$</span>phi1_union</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  phi2_union <span class="ot">&lt;-</span> result<span class="sc">$</span>phi2_union</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  cor_matrix <span class="ot">&lt;-</span> result<span class="sc">$</span>cor_matrix</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print ordered rows only if there are high correlations</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(cor_matrix <span class="sc">&gt;</span> <span class="fl">0.9</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    phi1_result <span class="ot">&lt;-</span> phi1_union[, <span class="fu">order</span>(<span class="fu">colMeans</span>(phi1_union), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    phi2_result <span class="ot">&lt;-</span> phi2_union[, <span class="fu">order</span>(<span class="fu">colMeans</span>(phi2_union), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call the modified function and pass high_corr_indices as an argument</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    final_result <span class="ot">&lt;-</span> <span class="fu">print_ordered_rows</span>(phi1_result, phi2_result, cor_matrix, high_corr_indices)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(final_result)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 1 - Topic 6 
Model 2 - Topic 1 
Model 1 - Topic 1 
Model 2 - Topic 6 
# A tibble: 20 × 4
   term_1   probability_1 term_2   probability_2
   &lt;chr&gt;            &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;
 1 nation         0.0329  nation         0.0233 
 2 unit           0.0231  unit           0.0174 
 3 peac           0.0137  intern         0.0114 
 4 intern         0.0129  peac           0.0110 
 5 world          0.0108  will           0.0107 
 6 will           0.00880 countri        0.00947
 7 state          0.00808 general        0.00918
 8 organ          0.00804 world          0.00869
 9 problem        0.00784 develop        0.00811
10 general        0.00779 problem        0.00803
11 econom         0.0431  countri        0.0434 
12 countri        0.0407  develop        0.0431 
13 develop        0.0322  econom         0.0320 
14 social         0.0206  industri       0.0153 
15 product        0.0119  product        0.0101 
16 technic        0.00939 social         0.00965
17 industri       0.00806 year           0.00931
18 programm       0.00761 economi        0.00896
19 american       0.00736 resourc        0.00895
20 trade          0.00708 price          0.00871</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 1 - Topic 7 
Model 2 - Topic 2 
Model 1 - Topic 6 
Model 2 - Topic 6 
Model 1 - Topic 1 
Model 2 - Topic 10 
# A tibble: 30 × 4
   term_1  probability_1 term_2  probability_2
   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 state         0.0309  state         0.0291 
 2 unit          0.0263  unit          0.0156 
 3 peopl         0.0215  peopl         0.0152 
 4 peac          0.0155  peac          0.0148 
 5 countri       0.0140  republ        0.0140 
 6 republ        0.0117  intern        0.0119 
 7 soviet        0.0115  soviet        0.0118 
 8 govern        0.0101  nation        0.0116 
 9 war           0.0100  secur         0.0108 
10 general       0.00859 countri       0.00923
# ℹ 20 more rows</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 1 - Topic 7 
Model 2 - Topic 7 
Model 1 - Topic 1 
Model 2 - Topic 8 
Model 1 - Topic 9 
Model 2 - Topic 9 
# A tibble: 30 × 4
   term_1    probability_1 term_2      probability_2
   &lt;chr&gt;             &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt;
 1 israel           0.0285 arab              0.0227 
 2 arab             0.0277 israel            0.0185 
 3 unit             0.0158 state             0.0159 
 4 peopl            0.0156 palestinian       0.0143 
 5 state            0.0139 unit              0.0127 
 6 territori        0.0127 peopl             0.0121 
 7 resolut          0.0118 peac              0.0107 
 8 peac             0.0115 resolut           0.0100 
 9 secur            0.0108 aggress           0.00909
10 nation           0.0108 secur             0.00899
# ℹ 20 more rows</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 1 - Topic 9 
Model 2 - Topic 2 
Model 1 - Topic 8 
Model 2 - Topic 7 
# A tibble: 20 × 4
   term_1  probability_1 term_2  probability_2
   &lt;chr&gt;           &lt;dbl&gt; &lt;chr&gt;           &lt;dbl&gt;
 1 world         0.0155  world         0.0181 
 2 nation        0.0125  will          0.0146 
 3 will          0.0114  nation        0.0133 
 4 us            0.00971 peopl         0.0121 
 5 one           0.00888 us            0.0110 
 6 can           0.00860 can           0.0106 
 7 must          0.00815 one           0.00972
 8 countri       0.00733 must          0.00877
 9 peopl         0.00607 new           0.00817
10 human         0.00579 war           0.00763
11 intern        0.0210  intern        0.0202 
12 nation        0.0163  develop       0.0144 
13 countri       0.0159  countri       0.0133 
14 develop       0.0129  peac          0.0117 
15 peac          0.0112  world         0.0105 
16 will          0.0103  nation        0.0102 
17 unit          0.0102  will          0.00998
18 econom        0.00953 econom        0.00858
19 right         0.00805 problem       0.00818
20 general       0.00802 co            0.00805</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 1 - Topic 2 
Model 2 - Topic 2 
# A tibble: 10 × 4
   term_1 probability_1 term_2 probability_2
   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;
 1 world        0.0181  nation       0.0185 
 2 will         0.0146  world        0.0156 
 3 nation       0.0133  must         0.0148 
 4 peopl        0.0121  us           0.0129 
 5 us           0.0110  unit         0.0125 
 6 can          0.0106  will         0.0118 
 7 one          0.00972 can          0.0115 
 8 must         0.00877 new          0.00851
 9 new          0.00817 human        0.00828
10 war          0.00763 one          0.00792</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 1 - Topic 7 
Model 2 - Topic 1 
Model 1 - Topic 3 
Model 2 - Topic 5 
Model 1 - Topic 2 
Model 2 - Topic 9 
# A tibble: 30 × 4
   term_1      probability_1 term_2      probability_2
   &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;               &lt;dbl&gt;
 1 peac              0.0206  intern            0.0178 
 2 intern            0.0193  peac              0.0161 
 3 secur             0.0111  state             0.0141 
 4 region            0.0110  peopl             0.0131 
 5 peopl             0.00998 secur             0.0108 
 6 palestinian       0.00991 palestinian       0.0103 
 7 state             0.00892 countri           0.00932
 8 will              0.00782 region            0.00928
 9 arab              0.00781 arab              0.00901
10 israel            0.00773 will              0.00775
# ℹ 20 more rows</code></pre>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Model 1 - Topic 9 
Model 2 - Topic 4 
Model 1 - Topic 2 
Model 2 - Topic 5 
Model 1 - Topic 1 
Model 2 - Topic 8 
Model 1 - Topic 5 
Model 2 - Topic 9 
Model 1 - Topic 6 
Model 2 - Topic 10 
# A tibble: 50 × 4
   term_1 probability_1 term_2 probability_2
   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;          &lt;dbl&gt;
 1 world        0.0154  will         0.0177 
 2 will         0.0145  world        0.0173 
 3 must         0.0129  us           0.0138 
 4 nation       0.0123  must         0.0116 
 5 peopl        0.0118  nation       0.0112 
 6 us           0.0112  peopl        0.0112 
 7 can          0.0107  can          0.0105 
 8 unit         0.00918 one          0.00901
 9 year         0.00813 unit         0.00755
10 one          0.00806 year         0.00711
# ℹ 40 more rows</code></pre>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>