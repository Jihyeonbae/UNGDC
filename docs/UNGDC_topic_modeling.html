<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dynamic UNGDC</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="UNGDC_topic_modeling_files/libs/clipboard/clipboard.min.js"></script>
<script src="UNGDC_topic_modeling_files/libs/quarto-html/quarto.js"></script>
<script src="UNGDC_topic_modeling_files/libs/quarto-html/popper.min.js"></script>
<script src="UNGDC_topic_modeling_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="UNGDC_topic_modeling_files/libs/quarto-html/anchor.min.js"></script>
<link href="UNGDC_topic_modeling_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="UNGDC_topic_modeling_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="UNGDC_topic_modeling_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="UNGDC_topic_modeling_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="UNGDC_topic_modeling_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Dynamic UNGDC</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="dynamic-topic-modeling-for-ungdc" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-topic-modeling-for-ungdc">Dynamic Topic Modeling for UNGDC</h2>
<p>In order to generate LDA topic modeling results for the corpus of UNGD, I split the corpus into different time frames. The entire time span of 1945 until 2022 is split into 8 intervals, with a duration of 10 years.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gplots)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seededlda)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(slam)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(jsonlite)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tm)</span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>light <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"~/Desktop/UNGDC/data/processed/cleaned.RDS"</span>)</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co">#Set up the parameters</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>light_interval <span class="ot">&lt;-</span> light <span class="sc">%&gt;%</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">span =</span> <span class="fu">as.factor</span>(<span class="fu">cut</span>(year,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                                     <span class="at">breaks =</span> <span class="fu">c</span>(<span class="fu">seq</span>(<span class="at">from =</span> <span class="dv">1945</span>, <span class="at">to =</span> <span class="dv">2022</span>, <span class="at">by =</span> <span class="dv">10</span>), <span class="dv">2022</span>)))) <span class="sc">%&gt;%</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(year)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="term-frequency-inverse-matrix-and-descriptive-data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="term-frequency-inverse-matrix-and-descriptive-data-visualization">Term Frequency-Inverse Matrix and Descriptive Data Visualization</h2>
<ul>
<li>To inspect the data and frequent words across time intervals, below code generates top-20 terms based on the tf-idf scores.</li>
<li>Input dataset: <a href="https://github.com/Jihyeonbae/UNGDC">“data/processed/cleaned.RDS”</a>.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># I added two additional stop words that aren't captured in the generic stop words dictionary. </span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>mystopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"will"</span>, <span class="st">"must"</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>custom_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">"english"</span>), mystopwords)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for generating tf_idf and plots.</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">sapply</span>(<span class="fu">levels</span>(light_interval<span class="sc">$</span>span), <span class="cf">function</span>(i) {</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  subset_i <span class="ot">&lt;-</span> light_interval <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(span <span class="sc">%in%</span> i)</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  corpus_subset <span class="ot">&lt;-</span> <span class="fu">Corpus</span>(<span class="fu">VectorSource</span>(subset_i<span class="sc">$</span>text))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  tdm <span class="ot">&lt;-</span> <span class="fu">TermDocumentMatrix</span>(corpus_subset,</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">control =</span> <span class="fu">list</span>(<span class="at">weighting =</span> weightTfIdf,</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">removePunctuation =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">stemming =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">removeNumbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">stopwords =</span> <span class="cn">TRUE</span>,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                                           <span class="at">removewords =</span> mystopwords))</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>  top_terms <span class="ot">&lt;-</span> slam<span class="sc">::</span><span class="fu">row_sums</span>(<span class="fu">as.matrix</span>(tdm))</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create a data frame with terms and tfidf values</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  top_terms_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">term =</span> <span class="fu">names</span>(top_terms), <span class="at">tfidf =</span> top_terms)</span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order the terms by tfidf value</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  top_terms_df <span class="ot">&lt;-</span> top_terms_df[<span class="fu">order</span>(top_terms_df<span class="sc">$</span>tfidf, <span class="at">decreasing =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Select the top 20 terms</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  top_terms_df <span class="ot">&lt;-</span> <span class="fu">head</span>(top_terms_df, <span class="dv">20</span>)</span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>  figure_i <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(top_terms_df, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(term, tfidf), <span class="at">y =</span> tfidf)) <span class="sc">+</span></span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Top 20 Terms by TF-IDF"</span>,</span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"Terms"</span>,</span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">"TF-IDF Score"</span>) <span class="sc">+</span></span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a>  output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">"figs/"</span>, <span class="fu">paste0</span>(<span class="st">"plot_"</span>, i, <span class="st">".png"</span>))</span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(output_file, figure_i, <span class="at">width =</span> <span class="dv">8</span>, <span class="at">height =</span> <span class="dv">5</span>, <span class="at">units =</span> <span class="st">"in"</span>)</span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co">#print out one sample</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"figs/plot_(2015, 2022].png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "figs/plot_(2015, 2022].png"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"figs/plot_(2005, 2015].png"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "figs/plot_(2005, 2015].png"</code></pre>
</div>
</div>
<ul>
<li>dfm function helps remove stop words and perform other preprocessing steps to create a more refined document-feature matrix. Additionally, the subsequent dfm_tfidf function is used to compute TF-IDF (Term Frequency-Inverse Document Frequency) scores, which down-weights terms that appear frequently across documents.</li>
</ul>
</section>
<section id="lda-topic-modeling" class="level1">
<h1>LDA Topic Modeling</h1>
<ul>
<li><p>In this section, I perform topic modeling using LDA, an unsupervised method to estimate vectors that represent topics within a speech.It assumes that each speech doument is a mixture of topics, and each word is attributable to one of the document’s topics.</p></li>
<li><p>Current parameters in the below code sets the number of topics as 10, and uses the TF-IDF scores.</p></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Topic Modeling</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>mystopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"will"</span>, <span class="st">"must"</span>)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>custom_stopwords <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">"english"</span>), mystopwords)</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>lda_generator <span class="ot">&lt;-</span> <span class="cf">function</span>(corpus, span_levels, <span class="at">num_topics =</span> <span class="dv">10</span>) {</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  output_dir <span class="ot">&lt;-</span> <span class="st">"~/Desktop/UNGDC/output/lda/decade_0203"</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(output_dir)) {</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(output_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> span_levels) {</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    subset <span class="ot">&lt;-</span> corpus[corpus<span class="sc">$</span>span <span class="sc">==</span> i, ]</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    subset_dfm <span class="ot">&lt;-</span> <span class="fu">dfm</span>(subset<span class="sc">$</span>text,</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">split_hyphens =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>                      <span class="at">stem =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                      <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                      <span class="at">tolower =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                      <span class="at">remove =</span> custom_stopwords)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>    dfm_idf <span class="ot">&lt;-</span> <span class="fu">dfm_tfidf</span>(subset_dfm,</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>                         <span class="at">scheme_tf =</span> <span class="st">"count"</span>,</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>                         <span class="at">scheme_df =</span> <span class="st">"inverse"</span>)</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    timing <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>      dfm_df <span class="ot">&lt;-</span> <span class="fu">convert</span>(dfm_idf, <span class="at">to =</span> <span class="st">"data.frame"</span>)</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>      dfm_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="fu">paste0</span>(<span class="st">"dfm_"</span>, i, <span class="st">".RDS"</span>))</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(dfm_df, dfm_output_file)</span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>      tmod_lda <span class="ot">&lt;-</span> <span class="fu">textmodel_lda</span>(subset_dfm, <span class="at">k =</span> num_topics)</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>      lda_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="fu">paste0</span>(<span class="st">"lda_model_"</span>, i, <span class="st">".RDS"</span>))</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(tmod_lda, lda_output_file)</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Time taken for %s: %s seconds</span><span class="sc">\n</span><span class="st">"</span>, i, timing[<span class="dv">3</span>]))</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a><span class="do">## New version since dfm() options deprecated within the quanteda package.</span></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>lda_generator <span class="ot">&lt;-</span> <span class="cf">function</span>(corpus, span_levels, <span class="at">num_topics =</span> <span class="dv">10</span>) {</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>  output_dir <span class="ot">&lt;-</span> <span class="st">"output/lda/decade_0203"</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(output_dir)) {</span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>    <span class="fu">dir.create</span>(output_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> span_levels) {</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>    subset <span class="ot">&lt;-</span> corpus[corpus<span class="sc">$</span>span <span class="sc">==</span> i, ]</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Use tokens() instead of dfm() for tokenization</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>    subset_tokens <span class="ot">&lt;-</span> <span class="fu">tokens</span>(subset<span class="sc">$</span>text,</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>                            <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>                            <span class="at">remove_punct =</span> <span class="cn">TRUE</span>,</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>                            <span class="at">split_hyphens =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tokens_wordstem</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tokens_tolower</span>() <span class="sc">%&gt;%</span></span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tokens_remove</span>(<span class="at">pattern =</span> custom_stopwords) <span class="sc">%&gt;%</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">tokens_compound</span>(<span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="fu">c</span>(<span class="st">"human rights*"</span>, <span class="st">"united nations"</span>)))</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Apply TF-IDF transformation directly on tokens</span></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    subset_tfidf <span class="ot">&lt;-</span> <span class="fu">dfm</span>(subset_tokens) <span class="sc">%&gt;%</span></span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>                     <span class="fu">dfm_tfidf</span>(<span class="at">scheme_tf =</span> <span class="st">"count"</span>, <span class="at">scheme_df =</span> <span class="st">"inverse"</span>)</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>     timing <span class="ot">&lt;-</span> <span class="fu">system.time</span>({</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>      dfm_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="fu">paste0</span>(<span class="st">"dfm_"</span>, i, <span class="st">".RDS"</span>))</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(<span class="fu">convert</span>(subset_tfidf, <span class="at">to=</span><span class="st">"data.frame"</span>), dfm_output_file)</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>      tmod_lda <span class="ot">&lt;-</span> <span class="fu">textmodel_lda</span>(subset_tfidf, <span class="at">k =</span> num_topics)</span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>      lda_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="fu">paste0</span>(<span class="st">"lda_model_"</span>, i, <span class="st">".RDS"</span>))</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>      <span class="fu">saveRDS</span>(tmod_lda, lda_output_file)</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"Time taken for %s: %s seconds</span><span class="sc">\n</span><span class="st">"</span>, i, timing[<span class="dv">3</span>]))</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through each decade and save separate LDA results. </span></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>span_levels <span class="ot">&lt;-</span> <span class="fu">levels</span>(light_interval<span class="sc">$</span>span)</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co">#lda_generator(light_interval, span_levels)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="reading-in-lda-results" class="level2">
<h2 class="anchored" data-anchor-id="reading-in-lda-results">Reading in LDA results</h2>
<p>After running the LDA model, I read in each LDA results as a separate element in a list form. Below code prins out top 10 terms associated with each topic in the LDA models for different span levels. Each row represents one semantic topic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>read_lda_models <span class="ot">&lt;-</span> <span class="cf">function</span>(span_levels, <span class="at">output_dir =</span> <span class="st">"~/Desktop/UNGDC/output/lda/decade_0203"</span>) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  lda_models <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> span_levels) {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    lda_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(output_dir, <span class="fu">paste0</span>(<span class="st">"lda_model_"</span>, i, <span class="st">".RDS"</span>))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">file.exists</span>(lda_output_file)) {</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>      lda_model <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(lda_output_file)</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>      lda_models[[i]] <span class="ot">&lt;-</span> lda_model</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"LDA model for %s successfully loaded.</span><span class="sc">\n</span><span class="st">"</span>, i))</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"LDA model file for %s not found.</span><span class="sc">\n</span><span class="st">"</span>, i))</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(lda_models)</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>output_directory <span class="ot">&lt;-</span> <span class="st">"~/Desktop/UNGDC/output/lda/decade_0203"</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>lda_models <span class="ot">&lt;-</span> <span class="fu">read_lda_models</span>(span_levels, output_directory)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>LDA model for (1945,1955] successfully loaded.
LDA model for (1955,1965] successfully loaded.
LDA model for (1965,1975] successfully loaded.
LDA model for (1975,1985] successfully loaded.
LDA model for (1985,1995] successfully loaded.
LDA model for (1995,2005] successfully loaded.
LDA model for (2005,2015] successfully loaded.
LDA model for (2015,2022] successfully loaded.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>topic_tables <span class="ot">&lt;-</span> <span class="cf">function</span>(lda_models, span_levels) {</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  topic_tables <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> span_levels) {</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (i <span class="sc">%in%</span> <span class="fu">names</span>(lda_models)) {</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>      lda_model <span class="ot">&lt;-</span> lda_models[[i]]</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>      terms <span class="ot">&lt;-</span> <span class="fu">terms</span>(lda_model, <span class="dv">10</span>)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>      topic_table <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">Terms =</span> terms)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>      topic_tables[[i]] <span class="ot">&lt;-</span> topic_table</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">cat</span>(<span class="fu">sprintf</span>(<span class="st">"LDA model for %s not found.</span><span class="sc">\n</span><span class="st">"</span>, i))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>  all_topics <span class="ot">&lt;-</span> <span class="fu">do.call</span>(rbind, topic_tables)</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(all_topics)</span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>topic_tables <span class="ot">&lt;-</span> <span class="fu">topic_tables</span>(lda_models, span_levels)</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(knitr<span class="sc">::</span><span class="fu">kable</span>(topic_tables))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>

|               |Terms.topic1  |Terms.topic2  |Terms.topic3 |Terms.topic4 |Terms.topic5 |Terms.topic6  |Terms.topic7 |Terms.topic8 |Terms.topic9 |Terms.topic10 |
|:--------------|:-------------|:-------------|:------------|:------------|:------------|:-------------|:------------|:------------|:------------|:-------------|
|(1945,1955].1  |bolivia       |tunisia       |veto         |soviet       |greek        |resumpt       |soviet       |india        |arab         |yugoslav      |
|(1945,1955].2  |communist     |dominican     |council      |communist    |greec        |armistic      |ussr         |hyderabad    |israel       |czechoslovak  |
|(1945,1955].3  |cuba          |morocco       |zealand      |union        |chile        |korea         |atom         |geneva       |palestin     |german        |
|(1945,1955].4  |chines        |franc         |netherland   |vyshinski    |uruguay      |collect       |weapon       |south        |egypt        |polish        |
|(1945,1955].5  |bolivian      |french        |court        |korea        |panama       |issu          |prohibit     |africa       |jerusalem    |yugoslavia    |
|(1945,1955].6  |colombia      |imprison      |vote         |canadian     |guerrilla    |uniti         |armament     |african      |egyptian     |germani       |
|(1945,1955].7  |costa         |tunisian      |arbitr       |can          |greece’      |europ         |union        |asian        |jew          |soviet        |
|(1945,1955].8  |trade         |philippin     |el           |disarma      |tsaldari     |intervent     |american     |bandung      |refuge       |poland        |
|(1945,1955].9  |latin         |court         |procedur     |canada       |jurid        |treati        |mr           |asia         |jewish       |people’       |
|(1945,1955].10 |argentin      |domin         |commiss      |aggress      |northern     |convent       |bevin        |china        |sudan        |geneva        |
|(1955,1965].1  |particip      |cuba          |malaysia     |cambodia     |arab         |german        |american     |bantu        |zealand      |african       |
|(1955,1965].2  |trade         |cuban         |pakistan     |lao          |israel       |socialist     |ecuador      |south        |australia    |algerian      |
|(1955,1965].3  |moscow        |panama        |netherland   |viet         |palestin     |soviet        |chile        |nigeria      |iceland      |libya         |
|(1955,1965].4  |industri      |american      |turkish      |communist    |egypt        |czechoslovak  |peru         |indian       |australian   |portug        |
|(1955,1965].5  |coexist       |guatemala     |indonesia    |spain        |canal        |albania       |mexico       |india        |canada       |africa        |
|(1955,1965].6  |cent          |dominican     |cyprus       |nam          |refuge       |germani       |argentin     |africa       |canadian     |libyan        |
|(1955,1965].7  |cold          |italian       |somali       |spanish      |jordan       |romanian      |latin        |african      |danish       |congo         |
|(1955,1965].8  |fire          |venezuela     |kashmir      |chines       |egyptian     |byelorussian  |uruguay      |congo        |inspect      |mali          |
|(1955,1965].9  |eighteen      |austrian      |india        |cambodian    |syria        |nato          |pan          |thing        |soviet       |portugues     |
|(1955,1965].10 |economi       |paraguay      |turkey       |pathet       |franc        |albanian      |argentina    |goa          |denmark      |cameroon      |
|(1965,1975].1  |african       |iceland       |like         |israel       |like         |imperialist   |haiti        |mauritania   |philippin    |pakistan      |
|(1965,1975].2  |rwanda        |panama        |programm     |arab         |socialist    |cuba          |ghana        |congo        |netherland   |india         |
|(1965,1975].3  |uganda        |venezuela     |nuclear      |israeli      |soviet       |khmer         |zealand      |chad         |austria      |oil           |
|(1965,1975].4  |zair          |salvador      |per          |palestin     |german       |imperi        |australia    |gabon        |italian      |indian        |
|(1965,1975].5  |burundi       |argentina     |strategi     |zionist      |mongolian    |cuban         |bolivia      |volta        |malaysia     |cyprus        |
|(1965,1975].6  |africa        |turkey        |neighbour    |palestinian  |byelorussian |aggress       |peru         |morocco      |itali        |kashmir       |
|(1965,1975].7  |kenya         |spain         |cent         |aggress      |ssr          |revisionist   |haitian      |sahara       |japan        |bangladesh    |
|(1965,1975].8  |zambia        |american      |china        |yemen        |czechoslovak |albania       |dominican    |upper        |burma        |grenada       |
|(1965,1975].9  |british       |ecuador       |viet         |israel’      |ukrainian    |ireland       |chile        |spanish      |indonesia    |price         |
|(1965,1975].10 |portug        |sea           |space        |jerusalem    |union        |revolutionari |pacif        |spain        |thailand     |nepal         |
|(1975,1985].1  |imperialist   |pleasur       |zionist      |guatemala    |soviet       |ethiopia      |¬            |guyana       |malta        |chad          |
|(1975,1985].2  |imperi        |dialog        |arab         |panama       |europ        |turkey        |bahama       |caribbean    |ireland      |guinea        |
|(1975,1985].3  |vietnames     |program       |islamic      |latin        |german       |uganda        |bangladesh   |india        |japan        |morocco       |
|(1975,1985].4  |lao           |cooper        |iraqi        |american     |socialist    |somalia       |tion         |lanka        |barbado      |burundi       |
|(1975,1985].5  |chines        |fortieth      |egypt        |ecuador      |union        |kenya         |con          |franc        |papua        |mali          |
|(1975,1985].6  |nam           |nonalign      |iranian      |rica         |mongolian    |ghana         |ment         |sri          |zealand      |oau           |
|(1975,1985].7  |kampuchea     |per           |israeli      |costa        |romania      |lesotho       |finland      |jamaica      |pacif        |rwanda        |
|(1975,1985].8  |viet          |indian        |yemen        |bolivia      |poland       |turkish       |burma        |dominica     |tobago       |seneg         |
|(1975,1985].9  |benin         |connect       |entiti       |hondura      |itali        |ethiopian     |sierra       |venezuela    |australia    |zair          |
|(1975,1985].10 |revolutionari |align         |austria      |canal        |commun       |portug        |leon         |grenada      |guinea       |equatori      |
|(1985,1995].1  |pakistan      |wish          |caribbean    |wish         |panama       |viet          |pacif        |sri          |chad         |malawi        |
|(1985,1995].2  |ireland       |organis       |saint        |arab         |panamanian   |nam           |japan        |lanka        |co           |burundi       |
|(1985,1995].3  |swaziland     |cooper        |paraguay     |islamic      |wish         |europ         |myanmar      |american     |niger        |guinea        |
|(1985,1995].4  |belarus       |recognis      |bahama       |iranian      |cuba         |european      |solomon      |ecuador      |nepal        |rwanda        |
|(1985,1995].5  |croatia       |dispar        |haiti        |lebanon      |canal        |romania       |zealand      |hondura      |namibia      |equatori      |
|(1985,1995].6  |bosnia        |liechtenstein |dominican    |iraqi        |philippin    |ukrain        |papua        |chile        |african      |liberia       |
|(1985,1995].7  |european      |percept       |bolivia      |tunisia      |revolut      |albania       |fiji         |turkey       |program      |uganda        |
|(1985,1995].8  |yugoslavia    |categori      |drug         |kuwait       |want         |poland        |australia    |latin        |fee          |zair          |
|(1985,1995].9  |tajikistan    |tend          |barbado      |egypt        |tell         |co            |franc        |turkish      |racist       |kenya         |
|(1985,1995].10 |azerbaijan    |realis        |haitian      |iraq         |enemi        |austria       |island       |costa        |pretoria     |benin         |
|(1995,2005].1  |outset        |outset        |outset       |outset       |outset       |outset        |outset       |outset       |afghanistan  |outset        |
|(1995,2005].2  |african       |arab          |latvia       |s            |korea        |azerbaijan    |tajikistan   |island       |trinidad     |european      |
|(1995,2005].3  |guinea        |iraq          |ecuador      |sixtieth     |korean       |cyprus        |croatia      |caribbean    |tobago       |herzegovina   |
|(1995,2005].4  |mongolia      |israel        |bolivia      |weapon       |malawi       |armenia       |turkmenistan |pacif        |pakistan     |kosovo        |
|(1995,2005].5  |ethiopia      |palestinian   |andorra      |sector       |burundi      |malta         |kazakhstan   |saint        |nepal        |belarus       |
|(1995,2005].6  |chad          |israeli       |chile        |commiss      |african      |turkey        |myanmar      |papua        |taliban      |€             |
|(1995,2005].7  |africa        |lebanon       |paraguay     |outcom       |africa       |spain         |viet         |bahama       |swaziland    |bosnia        |
|(1995,2005].8  |eritrea       |kuwait        |venezuela    |malaysia     |liberia      |georgia       |estonia      |barbado      |thailand     |ireland       |
|(1995,2005].9  |côte          |iraqi         |argentina    |uruguay      |kenya        |turkish       |asean        |solomon      |sri          |ukrain        |
|(1995,2005].10 |madagascar    |bahrain       |american     |wto          |uganda       |tunisia       |kyrgyzstan   |small        |monaco       |bulgaria      |
|(2005,2015].1  |everi         |everi         |everi        |everi        |everi        |everi         |everi        |everi        |everi        |everi         |
|(2005,2015].2  |european      |fiji          |ecuador      |arab         |mdgs         |island        |saint        |iran         |korea        |african       |
|(2005,2015].3  |serbia        |afghanistan   |panama       |yemen        |nuclear      |pacif         |bahama       |muslim       |azerbaijan   |mali          |
|(2005,2015].4  |georgia       |nepal         |paraguay     |kazakhstan   |treati       |solomon       |caribbean    |god          |japan        |somalia       |
|(2005,2015].5  |kosovo        |pakistan      |peru         |mongolia     |disarma      |sids          |trinidad     |syria        |korean       |africa        |
|(2005,2015].6  |bosnia        |timor         |america      |kuwait       |disput       |grenada       |tobago       |israel       |asean        |burundi       |
|(2005,2015].7  |ukrain        |tajikistan    |canada       |lebanon      |multilater   |tuvalu        |lucia        |war          |myanmar      |sudan         |
|(2005,2015].8  |herzegovina   |moldova       |bolivia      |marino       |mediat       |maldiv        |bangladesh   |islam        |ireland      |guinea        |
|(2005,2015].9  |cyprus        |lest          |american     |egypt        |weapon       |papua         |barbado      |want         |sri          |malawi        |
|(2005,2015].10 |malta         |afghan        |latin        |palestinian  |women        |ocean         |haiti        |jewish       |thailand     |somali        |
|(2015,2022].1  |african       |pacif         |distinct     |distinct     |sudan        |european      |trinidad     |covid        |ukrain       |guatemala     |
|(2015,2022].2  |mali          |island        |azerbaijan   |pandem       |pakistan     |serbia        |tobago       |un           |korea        |colombia      |
|(2015,2022].3  |bosnia        |ocean         |armenia      |energi       |india        |timor         |sri          |pandem       |russian      |brazil        |
|(2015,2022].4  |burundi       |solomon       |israel       |weapon       |georgia      |eu            |ireland      |vaccin       |russia       |spain         |
|(2015,2022].5  |herzegovina   |malaysia      |syrian       |peacekeep    |thailand     |montenegro    |morocco      |beliz        |japan        |costa         |
|(2015,2022].6  |congo         |tonga         |iran         |gender       |madagascar   |albania       |somalia      |saint        |korean       |andorra       |
|(2015,2022].7  |sahel         |mauritius     |arab         |digit        |kazakhstan   |bangladesh    |bahama       |75th         |latvia       |rica          |
|(2015,2022].8  |chad          |nepal         |palestinian  |trade        |turkmenistan |europ         |grenada      |bhutan       |ukrainian    |drug          |
|(2015,2022].9  |guinea        |papua         |kingdom      |sdgs         |afghanistan  |canada        |kenya        |guyana       |north        |mexico        |
|(2015,2022].10 |tanzania      |mongolia      |yemeni       |treati       |kyrgyzstan   |lest          |lanka        |caribbean    |china        |paraguay      |</code></pre>
</div>
</div>
<ul>
<li><p>Each column in the dataset corresponds to a vector of terms representing a specific topic. However, extracting substantively meaningful topics poses challenges due to several issues. One notable challenge is the variability in the set of terms used to represent the same topic across different time periods. For instance, the topic of international security may be discussed in relation to the Soviet Union and North Korea in earlier time periods, whereas in more recent times, it may be associated with Russia and Ukraine.</p></li>
<li><p>Another important problem is identifying related topics over time. There is a difficulty of establishing connections between topics and understanding their evolution across different temporal contexts. Some topics and terms disappear abruptly, while new topics emerge. Identifying the connection between vectors poses a challenge.</p></li>
</ul>
</section>
<section id="dynamic-topic-modeling" class="level2">
<h2 class="anchored" data-anchor-id="dynamic-topic-modeling">Dynamic Topic Modeling</h2>
<ul>
<li>To address the above mentioned challenges, we refered to existing papers.</li>
<li><code>"BERTopic Dynamic Topic Modeling"</code>(https://maartengr.github.io/BERTopic/getting_started/topicsovertime/topicsovertime.html)</li>
<li>Greene and cross, 2017 (https://doi.org/10.1017/pan.2016.7)</li>
</ul>
<section id="this-generates-output-for-a-single-pair-of-time-frames" class="level3">
<h3 class="anchored" data-anchor-id="this-generates-output-for-a-single-pair-of-time-frames">This generates output for a single pair of time frames</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>model1<span class="ot">&lt;-</span>lda_models[[<span class="dv">1</span>]]</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>model2<span class="ot">&lt;-</span>lda_models[[<span class="dv">2</span>]]</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># phi value is a topic probability of every word</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>phi1 <span class="ot">&lt;-</span> model1<span class="sc">$</span>phi</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a><span class="co">#phi1$topic &lt;- sequence(nrow(phi1))</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>phi2 <span class="ot">&lt;-</span> model2<span class="sc">$</span>phi</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co">#phi2$topic &lt;- sequence(nrow(phi2))</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert matrices to data frames</span></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>phi1_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phi1)</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>phi2_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phi2)</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>order_phi1 <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi1_df), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>order_phi2 <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi2_df), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns based on the mean</span></span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>phi1_df <span class="ot">&lt;-</span> phi1_df[, order_phi1]</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>phi2_df <span class="ot">&lt;-</span> phi2_df[, order_phi2]</span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Identify columns to drop based on colMeans</span></span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a><span class="do">## Try without dropping</span></span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>columns_to_drop_phi1 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(phi1_df) <span class="sc">&lt;</span> <span class="fl">0.00001</span></span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>columns_to_drop_phi2 <span class="ot">&lt;-</span> <span class="fu">colMeans</span>(phi2_df) <span class="sc">&lt;</span> <span class="fl">0.00001</span></span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Drop identified columns</span></span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>phi1_df <span class="ot">&lt;-</span> phi1_df[, <span class="sc">!</span>columns_to_drop_phi1, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>phi2_df <span class="ot">&lt;-</span> phi2_df[, <span class="sc">!</span>columns_to_drop_phi2, drop <span class="ot">=</span> <span class="cn">FALSE</span>]</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Get the union of column names</span></span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>all_terms <span class="ot">&lt;-</span> <span class="fu">union</span>(<span class="fu">colnames</span>(phi1_df), <span class="fu">colnames</span>(phi2_df))</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co">#fill missing values with zeros</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>phi1_union <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(phi1_df, <span class="fu">setNames</span>(<span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(phi1_df), <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi1_df))))), <span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi1_df))))</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a>phi2_union <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(phi2_df, <span class="fu">setNames</span>(<span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(phi2_df), <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi2_df))))), <span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi2_df))))</span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a><span class="co"># Reorder columns alphabetically</span></span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>phi1_union <span class="ot">&lt;-</span> phi1_union[, <span class="fu">order</span>(<span class="fu">colnames</span>(phi1_union))]</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>phi2_union <span class="ot">&lt;-</span> phi2_union[, <span class="fu">order</span>(<span class="fu">colnames</span>(phi2_union))]</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(phi1_union)</span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(phi2_union)</span>
<span id="cb12-48"><a href="#cb12-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-49"><a href="#cb12-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-50"><a href="#cb12-50" aria-hidden="true" tabindex="-1"></a>cor<span class="ot">&lt;-</span><span class="fu">cor</span>(<span class="fu">t</span>(phi1_union), <span class="fu">t</span>(phi2_union))</span>
<span id="cb12-51"><a href="#cb12-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-52"><a href="#cb12-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-53"><a href="#cb12-53" aria-hidden="true" tabindex="-1"></a><span class="fu">heatmap.2</span>(cor,</span>
<span id="cb12-54"><a href="#cb12-54" aria-hidden="true" tabindex="-1"></a>          <span class="at">Rowv =</span> <span class="cn">FALSE</span>, <span class="at">Colv =</span> <span class="cn">FALSE</span>,</span>
<span id="cb12-55"><a href="#cb12-55" aria-hidden="true" tabindex="-1"></a>          <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">256</span>),</span>
<span id="cb12-56"><a href="#cb12-56" aria-hidden="true" tabindex="-1"></a>          <span class="at">trace =</span> <span class="st">"none"</span>, <span class="co"># no row/column names</span></span>
<span id="cb12-57"><a href="#cb12-57" aria-hidden="true" tabindex="-1"></a>          <span class="at">key =</span> <span class="cn">TRUE</span>, <span class="at">keysize =</span> <span class="fl">1.5</span>,</span>
<span id="cb12-58"><a href="#cb12-58" aria-hidden="true" tabindex="-1"></a>          <span class="at">density.info =</span> <span class="st">"none"</span>, <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb12-59"><a href="#cb12-59" aria-hidden="true" tabindex="-1"></a>          <span class="at">cexCol =</span> <span class="dv">1</span>, <span class="at">cexRow =</span> <span class="dv">1</span>, <span class="co"># adjust text size</span></span>
<span id="cb12-60"><a href="#cb12-60" aria-hidden="true" tabindex="-1"></a>          <span class="at">notecol =</span> <span class="st">"black"</span>, <span class="at">notecex =</span> <span class="fl">0.7</span>,</span>
<span id="cb12-61"><a href="#cb12-61" aria-hidden="true" tabindex="-1"></a>          <span class="at">main =</span> <span class="st">"Correlation Matrix"</span>,</span>
<span id="cb12-62"><a href="#cb12-62" aria-hidden="true" tabindex="-1"></a>          <span class="at">xlab =</span> <span class="st">"Period 2"</span>, <span class="at">ylab =</span> <span class="st">"Period 1"</span>,</span>
<span id="cb12-63"><a href="#cb12-63" aria-hidden="true" tabindex="-1"></a>          <span class="at">symkey =</span> <span class="cn">FALSE</span>)</span>
<span id="cb12-64"><a href="#cb12-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-65"><a href="#cb12-65" aria-hidden="true" tabindex="-1"></a>order_phi1_union <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi1_union), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-66"><a href="#cb12-66" aria-hidden="true" tabindex="-1"></a>phi1_result <span class="ot">&lt;-</span> phi1_union[, order_phi1_union]</span>
<span id="cb12-67"><a href="#cb12-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-68"><a href="#cb12-68" aria-hidden="true" tabindex="-1"></a>order_phi2_union <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi2_union), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-69"><a href="#cb12-69" aria-hidden="true" tabindex="-1"></a>phi2_result <span class="ot">&lt;-</span> phi2_union[, order_phi2_union]</span>
<span id="cb12-70"><a href="#cb12-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-71"><a href="#cb12-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-72"><a href="#cb12-72" aria-hidden="true" tabindex="-1"></a>phi1_result_row <span class="ot">&lt;-</span> <span class="fu">orderBasedOnRow</span>(phi1_union, <span class="dv">1</span>)</span>
<span id="cb12-73"><a href="#cb12-73" aria-hidden="true" tabindex="-1"></a>phi1_result_long<span class="ot">&lt;-</span>phi1_result_row<span class="sc">%&gt;%</span></span>
<span id="cb12-74"><a href="#cb12-74" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to=</span><span class="st">"term_1"</span>, <span class="at">values_to=</span><span class="st">"probability_1"</span>)</span>
<span id="cb12-75"><a href="#cb12-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-76"><a href="#cb12-76" aria-hidden="true" tabindex="-1"></a>phi2_result_row <span class="ot">&lt;-</span> <span class="fu">orderBasedOnRow</span>(phi2_union, <span class="dv">6</span>)</span>
<span id="cb12-77"><a href="#cb12-77" aria-hidden="true" tabindex="-1"></a>phi2_result_long<span class="ot">&lt;-</span>phi2_result_row<span class="sc">%&gt;%</span></span>
<span id="cb12-78"><a href="#cb12-78" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to=</span><span class="st">"term_2"</span>, <span class="at">values_to=</span><span class="st">"probability_2"</span>)</span>
<span id="cb12-79"><a href="#cb12-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-80"><a href="#cb12-80" aria-hidden="true" tabindex="-1"></a>pair<span class="ot">&lt;-</span><span class="fu">bind_cols</span>(phi1_result_long, phi2_result_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>#Function to print out the words</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>orderBasedOnRow <span class="ot">&lt;-</span> <span class="cf">function</span>(df, I) {</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Order columns based on the Ith row values</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  ordered_cols <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">apply</span>(df, <span class="dv">2</span>, <span class="cf">function</span>(x) x[I]), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Reorder the data frame columns</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  ordered_df <span class="ot">&lt;-</span> df[, ordered_cols]</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>  ordered_row <span class="ot">&lt;-</span> ordered_df[I, <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(ordered_row)</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="below-function-generates-heatmaps-for-a-pair-of-models." class="level2">
<h2 class="anchored" data-anchor-id="below-function-generates-heatmaps-for-a-pair-of-models.">Below function generates heatmaps for a pair of models.</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to generate the heatmap for a pair of models</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>generate_heatmap <span class="ot">&lt;-</span> <span class="cf">function</span>(model1, model2, <span class="at">correlation_threshold =</span> <span class="fl">0.9</span>) {</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  phi1 <span class="ot">&lt;-</span> model1<span class="sc">$</span>phi</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  phi2 <span class="ot">&lt;-</span> model2<span class="sc">$</span>phi</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  phi1_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phi1)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  phi2_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(phi2)</span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  order_phi1 <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi1_df), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  order_phi2 <span class="ot">&lt;-</span> <span class="fu">order</span>(<span class="fu">colMeans</span>(phi2_df), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>  phi1_df <span class="ot">&lt;-</span> phi1_df[, order_phi1]</span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  phi2_df <span class="ot">&lt;-</span> phi2_df[, order_phi2]</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>  all_terms <span class="ot">&lt;-</span> <span class="fu">union</span>(<span class="fu">colnames</span>(phi1_df), <span class="fu">colnames</span>(phi2_df))</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>  phi1_union <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(phi1_df, <span class="fu">setNames</span>(<span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(phi1_df), <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi1_df))))), <span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi1_df))))</span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb14-20"><a href="#cb14-20" aria-hidden="true" tabindex="-1"></a>  phi2_union <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">bind_cols</span>(phi2_df, <span class="fu">setNames</span>(<span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(phi2_df), <span class="at">ncol =</span> <span class="fu">length</span>(<span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi2_df))))), <span class="fu">setdiff</span>(all_terms, <span class="fu">colnames</span>(phi2_df))))</span>
<span id="cb14-21"><a href="#cb14-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-22"><a href="#cb14-22" aria-hidden="true" tabindex="-1"></a>  phi1_union <span class="ot">&lt;-</span> phi1_union[, <span class="fu">order</span>(<span class="fu">colnames</span>(phi1_union))]</span>
<span id="cb14-23"><a href="#cb14-23" aria-hidden="true" tabindex="-1"></a>  phi2_union <span class="ot">&lt;-</span> phi2_union[, <span class="fu">order</span>(<span class="fu">colnames</span>(phi2_union))]</span>
<span id="cb14-24"><a href="#cb14-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-25"><a href="#cb14-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(phi1_union)</span>
<span id="cb14-26"><a href="#cb14-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dim</span>(phi2_union)</span>
<span id="cb14-27"><a href="#cb14-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-28"><a href="#cb14-28" aria-hidden="true" tabindex="-1"></a>  cor_matrix <span class="ot">&lt;-</span> <span class="fu">cor</span>(<span class="fu">t</span>(phi1_union), <span class="fu">t</span>(phi2_union))</span>
<span id="cb14-29"><a href="#cb14-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-30"><a href="#cb14-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-31"><a href="#cb14-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Heatmap for correlation matrix</span></span>
<span id="cb14-32"><a href="#cb14-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">heatmap.2</span>(cor_matrix,</span>
<span id="cb14-33"><a href="#cb14-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">Rowv =</span> <span class="cn">FALSE</span>, <span class="at">Colv =</span> <span class="cn">FALSE</span>,</span>
<span id="cb14-34"><a href="#cb14-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">col =</span> <span class="fu">heat.colors</span>(<span class="dv">16</span>),</span>
<span id="cb14-35"><a href="#cb14-35" aria-hidden="true" tabindex="-1"></a>            <span class="at">trace =</span> <span class="st">"none"</span>, <span class="co"># no row/column names</span></span>
<span id="cb14-36"><a href="#cb14-36" aria-hidden="true" tabindex="-1"></a>            <span class="at">key =</span> <span class="cn">TRUE</span>, <span class="at">keysize =</span> <span class="fl">1.5</span>,</span>
<span id="cb14-37"><a href="#cb14-37" aria-hidden="true" tabindex="-1"></a>            <span class="at">density.info =</span> <span class="st">"none"</span>, <span class="at">margins =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>),</span>
<span id="cb14-38"><a href="#cb14-38" aria-hidden="true" tabindex="-1"></a>            <span class="at">cexCol =</span> <span class="dv">1</span>, <span class="at">cexRow =</span> <span class="dv">1</span>, <span class="co"># adjust text size</span></span>
<span id="cb14-39"><a href="#cb14-39" aria-hidden="true" tabindex="-1"></a>            <span class="at">notecol =</span> <span class="st">"black"</span>, <span class="at">notecex =</span> <span class="fl">0.7</span>,</span>
<span id="cb14-40"><a href="#cb14-40" aria-hidden="true" tabindex="-1"></a>            <span class="at">xlab =</span> <span class="st">"Time 2"</span>,</span>
<span id="cb14-41"><a href="#cb14-41" aria-hidden="true" tabindex="-1"></a>            <span class="at">ylab =</span> <span class="st">"Time 1"</span>,</span>
<span id="cb14-42"><a href="#cb14-42" aria-hidden="true" tabindex="-1"></a>            <span class="at">symkey =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-43"><a href="#cb14-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-44"><a href="#cb14-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">list</span>(<span class="at">phi1_union =</span> phi1_union, <span class="at">phi2_union =</span> phi2_union, <span class="at">cor_matrix =</span> cor_matrix))</span>
<span id="cb14-45"><a href="#cb14-45" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="rows-with-high-correlation" class="level2">
<h2 class="anchored" data-anchor-id="rows-with-high-correlation">Rows with high correlation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function to print the ordered rows for each topic with high correlation</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>print_ordered_rows <span class="ot">&lt;-</span> <span class="cf">function</span>(phi1_union, phi2_union, cor_matrix, high_corr_indices, <span class="at">correlation_threshold =</span> <span class="fl">0.9</span>) {</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Find indices where correlation is higher than the threshold</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  high_corr_indices <span class="ot">&lt;-</span> <span class="fu">which</span>(cor_matrix <span class="sc">&gt;</span> correlation_threshold <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(cor_matrix), <span class="at">arr.ind =</span> <span class="cn">TRUE</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create an empty list to store results</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>  result_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print the ordered rows for each topic with high correlation</span></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="fu">seq_len</span>(<span class="fu">nrow</span>(high_corr_indices))) {</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    model1_topic <span class="ot">&lt;-</span> high_corr_indices[i, <span class="dv">1</span>]</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    model2_topic <span class="ot">&lt;-</span> high_corr_indices[i, <span class="dv">2</span>]</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Print the ordered rows for each model's topic</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Model 1 - Topic"</span>, model1_topic), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>    phi1_result_row <span class="ot">&lt;-</span> <span class="fu">orderBasedOnRow</span>(phi1_union, model1_topic)</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">cat</span>(<span class="fu">paste</span>(<span class="st">"Model 2 - Topic"</span>, model2_topic), <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>    phi2_result_row <span class="ot">&lt;-</span> <span class="fu">orderBasedOnRow</span>(phi2_union, model2_topic)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Convert result rows to long format</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>    phi1_result_long <span class="ot">&lt;-</span> phi1_result_row <span class="sc">%&gt;%</span></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"term_1"</span>, <span class="at">values_to =</span> <span class="st">"probability_1"</span>)</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a>    phi2_result_long <span class="ot">&lt;-</span> phi2_result_row <span class="sc">%&gt;%</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a>      tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="fu">everything</span>(), <span class="at">names_to =</span> <span class="st">"term_2"</span>, <span class="at">values_to =</span> <span class="st">"probability_2"</span>)</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Combine phi1 and phi2 results</span></span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a>    pair <span class="ot">&lt;-</span> knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="fu">bind_cols</span>(phi1_result_long, phi2_result_long))</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-31"><a href="#cb15-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Append the result to the list</span></span>
<span id="cb15-32"><a href="#cb15-32" aria-hidden="true" tabindex="-1"></a>    result_list[[i]] <span class="ot">&lt;-</span> pair</span>
<span id="cb15-33"><a href="#cb15-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-34"><a href="#cb15-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-35"><a href="#cb15-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine all results into a single dataframe</span></span>
<span id="cb15-36"><a href="#cb15-36" aria-hidden="true" tabindex="-1"></a>  final_result <span class="ot">&lt;-</span> <span class="fu">do.call</span>(bind_rows, result_list)</span>
<span id="cb15-37"><a href="#cb15-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-38"><a href="#cb15-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(final_result)</span>
<span id="cb15-39"><a href="#cb15-39" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="execute-functions-over-pairs" class="level2">
<h2 class="anchored" data-anchor-id="execute-functions-over-pairs">Execute functions over pairs</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Loop through pairs of models to generate heatmaps and print results</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(lda_models) <span class="sc">-</span> <span class="dv">1</span>)) {</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  model1 <span class="ot">&lt;-</span> lda_models[[i]]</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  model2 <span class="ot">&lt;-</span> lda_models[[i <span class="sc">+</span> <span class="dv">1</span>]]</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  result <span class="ot">&lt;-</span> <span class="fu">generate_heatmap</span>(model1, model2, <span class="at">correlation_threshold =</span> <span class="fl">0.9</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  phi1_union <span class="ot">&lt;-</span> result<span class="sc">$</span>phi1_union</span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>  phi2_union <span class="ot">&lt;-</span> result<span class="sc">$</span>phi2_union</span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>  cor_matrix <span class="ot">&lt;-</span> result<span class="sc">$</span>cor_matrix</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Print ordered rows only if there are high correlations</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">any</span>(cor_matrix <span class="sc">&gt;</span> <span class="fl">0.9</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a>    phi1_result <span class="ot">&lt;-</span> phi1_union[, <span class="fu">order</span>(<span class="fu">colMeans</span>(phi1_union), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    phi2_result <span class="ot">&lt;-</span> phi2_union[, <span class="fu">order</span>(<span class="fu">colMeans</span>(phi2_union), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)]</span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Call the modified function and pass high_corr_indices as an argument</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>    final_result <span class="ot">&lt;-</span> <span class="fu">print_ordered_rows</span>(phi1_result, phi2_result, cor_matrix, high_corr_indices)</span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(final_result)</span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="UNGDC_topic_modeling_files/figure-html/unnamed-chunk-10-7.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>